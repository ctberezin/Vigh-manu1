---
title: "RNAscope-McKO-new-probe"
author: "C-T Berezin"
date: "11/21/2021"
output:
  pdf_document: default
  html_document: default
---

```{r}
#analysis of MOR McKO validation using new RNAscope probe
library(tibble)
library(dplyr)
library(stringr)
library(ggplot2)
library(ggpubr)
library(ggthemes)
```

```{r}
#creating the data frame from values logged on google sheet
genotype <- c("WT", "WT", "WT", "WT", "McKO", "McKO", "McKO", "McKO")
sex <- c("F", "F", "M", "M", "F", "F", "M", "M")
number <- c(46, 47, 6, 77, 95, 98, 58, 92)
positive <- c(13, 17, 7, 13, 0, 1, 2, 4)
total <- c(16, 17, 7, 14, 1, 9, 6, 19)

data <- tibble(genotype, sex, number, positive, total)

data <- mutate(data,
                number = str_c(number),
                percent = positive/total*100)
```

```{r}
#assessing normality
shapiro.test(data$percent)

#creating linear model and checking assumptions
morlm <- lm(percent ~ genotype, data)

resid <- rstandard(morlm)
yhat <- morlm$fitted.values
ggplot(data, aes(x=yhat, y=resid)) +
  geom_point()

qqnorm(resid)
abline(0, 1, lty = 2)

#t-test to assess whether genotype predicts percent of positive MOR+ ipRGCs
#it does - statistically significant decrease in McKO versus WT
t.test(percent ~ genotype, data)

#checking for a sex difference, there is none
t.test(percent ~ sex, data)


#checking the power
wts_only <- data %>% filter(genotype == "WT")
sd(wts_only$percent)
#sd is 8.85
mckos_only <- data %>% filter(genotype == "McKO")
#calculating delta (change in means between groups)
mean(wts_only$percent) - mean(mckos_only$percent)
#delta is 77.15
power.t.test(n=4, delta=77.15, sd=8.85, type = "one.sample", alternative="one.sided")
#power is 1

range(wts_only$percent)
range(mckos_only$percent)
```

```{r}
#same t.test as above but using ggpubr to put p-value into geom_bracket
stat.test <- compare_means(percent ~ genotype, data, method = "t.test")


mcko_plot <- ggplot(data, aes(genotype, percent)) +
  geom_point(alpha=0.75) +
  stat_summary(fun = 'mean', geom="bar", aes(alpha=0.5)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width=.1, alpha=0.5) +
  theme_few() +
  theme(legend.position = "none") +
  labs(y="% ipRGCs with MOR mRNA",
       title = "RNAscope labeling of MOR mRNA") +
  geom_bracket(
    aes(xmin = "WT", xmax = "McKO", label = signif(p, 2)),
    data = stat.test, y.position = 110) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)))

ggsave(filename="../figures/RNAscope_McKO.png", plot=mcko_plot, height=3, width=3)
```
